<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>WebRTC test stub</title>
    <!-- supervisor -i dist -n exit `which grunt` -->
    <!-- open /Applications/Google\ Chrome\ Canary.app --args --enable-data-channels -->
    <script src="pouchdb-nightly.js"></script>
</head>
<body>
(Open the console, HAL.)

<script>
//Pouch.destroy("idb://_allDbs", function () {});
Pouch.destroy("idb://webrtc-test", function () {
console.log("destroyed");
Pouch("idb://webrtc-test", function (e, hub) {
    if (e) throw e;
Pouch.dbgPeerPouch.Presence.verifyHub(hub, function (e, v) {
    if (e) throw e;
    
    var a = Pouch.dbgPeerPouch.Presence(hub, {name:"Alice",identity:'a'}),
        b = Pouch.dbgPeerPouch.Presence(hub, {name:"Bob",identity:'b'});
    
    setTimeout(function () {
      a.getPeers(function (e,d) {
          if (e) throw e;
          
          console.log("Peers are:", d);
          a.connectToPeer(d[0], function (e) {
            if (e) throw e;
            else console.log("Connected!");
          });
      });
    }, 1000);
    
    dbgHub = hub, dbgA = a, dbgB = b;
});   // verifyHub
});   // Pouch
});   // destroy
</script>
</body>
</html>